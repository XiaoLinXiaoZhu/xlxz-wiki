### 策划公式

感觉这一部分我的传达没有到位，下面我进一步解释一下：

#### target.md 中的描述

### 策划公式

> latex 在 markdown 中提供了一个功能非常齐全的公式编辑器，但是对于游戏策划案来说，设计方程式永远没有传达逻辑关系更为重要，因为不论如何设计一个公式，它都能够被声明为 function Y(args[]) , 只要声明为了这个，那么实际上后续如果需要修改公式，开发都可以通过修改 function 的实现来完成。只要它的输入和输出是正确的，那么就可以了。
> 
> 所以我希望能够使用一些特殊的语法来描述策划公式，比如说在文档中使用
> ```md
> %% [伤害] = <暴击率> * (<暴击伤害> + 1) * <攻击力> * (1-[防御减伤比例]) %%
> %% [实际伤害] = [伤害] * (1 - <减伤比例>) - <固定减伤值> %%
> ```
> 其中 `<暴击率>` 、 `<攻击力>` 、 `<暴击伤害>` 和 `<防御减伤比例>` 是设计值，它们是从游戏中获取的值，或者是由策划直接指定的值
> 而 `[伤害]` 和 `[实际伤害]` 是计算值，它是由 `<暴击率>`、`<暴击伤害>`、`<攻击力>` 和 `<防御减伤比例>` 计算得来的。
> 
> 换句话说，上面的公式实际上描述的是：
> ```c#
> float CalculateDamage(float critRate, float critDamage, float attackPower, float defenseReductionRate) {
>     return critRate * (critDamage + 1) * attackPower * (1 - defenseReductionRate);
> }
> 
> float CalculateActualDamage(float damage, float damageReductionRate, float fixedReductionValue) {
>     return damage * (1 - damageReductionRate) - fixedReductionValue;
> }
> 
> actualDamage = CalculateActualDamage(CalculateDamage(critRate, critDamage, attackPower, defenseReductionRate), damageReductionRate, fixedReductionValue);
> ```
> 
> 假设后续我需要修改公式，那么也只是修改 `CalculateDamage` 和 `CalculateActualDamage` 的实现即可，而不需要修改其他地方的代码。
> 
> 
> 进行了上述定义后，当鼠标悬停在 `[伤害]` 上时，能够显示 `[伤害]` 的 （区域定义 | 全局定义）（如果有）和计算方式（如果有），而鼠标悬停在 `<减伤比例>` 上时，能够显示 `<减伤比例>` 的 （区域定义 | 全局定义）（如果有），它没有计算方式，因为它是一个设计值。
> 
> *有区域定义的时候，区域定义展示在全局定义之前，且区域定义的优先级高于全局定义。*
> 
> 比如文档中：
> ```
> 【伤害】：玩家造成的伤害，不是实际值，但是会传递给目标进行下一步计算
> 【实际伤害】：玩家造成的实际伤害，经过减伤计算后的值
> 【暴击率】：玩家的暴击率
> 【暴击伤害】：玩家的暴击伤害，计算玩家暴击了之后的伤害应该是 攻击力 * (1 + 暴击伤害)
> 【攻击力】：玩家的攻击力
> 
> %% [伤害] = <暴击率> * (<暴击伤害> + 1) * <攻击力> * (1-[防御减伤比例]) %%
> %% [实际伤害] = [伤害] * (1 - <减伤比例>) - <固定减伤值> %%
> ```
> 
> 那么当鼠标悬停在 `[伤害]` 上时，能够显示如下内容：
> ```
> 玩家造成的伤害，不是实际值，但是会传递给目标进行下一步计算
> 
> 关联公式：（仅仅展示当前文档中的公式）
> [伤害] = <暴击率> * (<暴击伤害> + 1) * <攻击力> * (1-[防御减伤比例])
> ```
> 
> 当鼠标悬停在 `<暴击率>` 上时，能够显示如下内容：
> ```
> 玩家的暴击率
> 
> 关联公式：（仅仅展示当前文档中的公式）
> [伤害] = <暴击率> * (<暴击伤害> + 1) * <攻击力> * (1-[防御减伤比例])
> ```
> 
> 当鼠标悬停在 `<减伤比例>` 上时，不显示悬浮卡片，因为它是一个设计值，且没有区域定义或者全局定义。
> 
> 当鼠标悬停在 `[实际伤害]` 上时，能够显示如下内容：
> ```
> 玩家造成的实际伤害，经过减伤计算后的值
> 
> [实际伤害] = [伤害] * (1 - <减伤比例>) - <固定减伤值>
> ```
> 
> 在该卡片上进一步悬停能够继续展开
> ```
> 玩家造成的伤害，不是实际值，但是会传递给目标进行下一步计算
> 
> [伤害] = <暴击率> * (<暴击伤害> + 1) * <攻击力> * (1-[防御减伤比例])
> ```


### 解释

现在就是，我看到你以及完成了对他的特殊渲染，比如：
```html
<div class="wiki-formula"><span class="wiki-calculated-value">[伤害]</span> = <span class="wiki-design-value">&lt;暴击率&gt;</span> * (<span class="wiki-design-value">&lt;暴击伤害&gt;</span> + 1) * <span class="wiki-design-value">&lt;攻击力&gt;</span> * (1-<span class="wiki-calculated-value">[防御减伤比例]</span>)</div>
```

没什么问题，但是问题是，下面的鼠标悬浮展示信息等，因为我们的展示悬浮卡片已经改为了 使用 vue 组件的方式来实现了，所以说，这个地方没有更新 导致 没有显示。

此外有关于 “相关公式” 的展示也需要进行相应的更新。请注意它只需要展示当前文档中的公式，我们没有全局公式这种东西，它的地位类似于 “文件内定义” ，它只作用于当前文档。