# XLXZ Wiki v4

游戏策划案专用的 Wiki 文档系统 — 用 Markdown 写策划案，自动识别词条引用并提供悬停定义卡片。

## 功能特性

- **词条引用** `【词条名】` — 自动识别并渲染为可交互元素，悬停显示定义卡片
- **别名系统** — frontmatter `alias` 字段，多个名称指向同一定义
- **文件内定义** `【词条】：定义` — 当前文件内的临时定义
- **区域定义 scope** — 多项目词条隔离，支持 `【scope/词条】` 显式引用
- **策划公式** `%% [计算值] = <设计值> * ... %%` — 计算值/设计值高亮，悬停展示公式和定义
- **近似匹配** — 未找到词条时提示拼写相似的词条
- **嵌套悬停** — 卡片内的词条引用可继续悬停，支持多层嵌套
- **实时更新** — 外部修改 .md 文件后，页面自动刷新
- **文件树导航** — 侧边栏树形结构浏览文档

## 快速开始

### 环境要求

- [Bun](https://bun.sh/) >= 1.0
- [Node.js](https://nodejs.org/) >= 18（用于 Vite 构建）
- [pnpm](https://pnpm.io/)

### 安装

```bash
pnpm install
```

### 开发模式

```bash
# 终端 1：启动前端开发服务器
pnpm dev

# 终端 2：启动后端服务器（带热重载）
pnpm server:dev
```

前端访问 `http://localhost:5173`，API 请求自动代理到后端 `http://localhost:3055`。

### 生产模式

```bash
# 构建前端 + 启动服务器
pnpm build
pnpm server:start
```

访问 `http://127.0.0.1:3055`。

### 打包为可执行程序

```bash
# 一键构建前端 + 编译服务器
pnpm release
```

生成 `xlxz-wiki.exe`，与 `dist/` 和 `wiki-docs/` 放在同一目录下即可运行。

## 文档语法

### 词条定义文件

每个 `.md` 文件可以通过 frontmatter 定义词条：

```md
---
alias:
  - 滑移
  - 基础移动方式
scope: 角色系统        # 可选，区域定义
---

滑移是游戏中玩家的主要移动方式之一。
```

### 词条引用

在任意文档中使用 `【词条名】` 引用词条：

```md
玩家【滑移】结束后，会产生冲击。
```

### 文件内定义

使用 `【词条】：定义内容` 创建仅在当前文件生效的定义：

```md
【施法者】：发起滑移的玩家
【目标】：被冲击的对象
```

### 策划公式

使用 `%% 表达式 %%` 定义策划公式：

```md
%% [伤害] = <暴击率> * (<暴击伤害> + 1) * <攻击力> %%
```

- `[xxx]` — 计算值（蓝色加粗）
- `<xxx>` — 设计值（紫色斜体）

### 区域定义

通过 `scope` 隔离不同项目的同名词条：

```md
---
scope: game1
---
在 game1 中，【NPC】会显示 game1 的定义。
使用【game2/NPC】可以显式引用其他区域的定义。
```

## 项目结构

```
xlxz-wiki/
├── server/          # 后端（Hono + Bun）
├── src/             # 前端（Vue 3 + Vite）
├── shared/          # 前后端共享类型
├── wiki-docs/       # 策划案文档
├── tests/           # 单元测试
└── docs/            # 项目文档
```

## 测试

```bash
bun test
```

## 技术栈

| 层 | 选型 |
|----|------|
| 运行时 | Bun |
| 后端框架 | Hono |
| 前端框架 | Vue 3 + Vite |
| 状态管理 | Pinia |
| Markdown 渲染 | markdown-it |
| 通信 | REST + WebSocket |
| 打包 | Bun compile |

## License

Private
